---
author: Markus
tags:
  - Docker
  - 小程序
---

# Taro+Nestjs 小程序开发血泪史

因公司有项目需要开发小程序，借机整了备份梯子地址的小程序顺便提前接触一下，久闻小程序开发有坑，这几天踩下来感觉还行，找个地方记录一下(写这篇文章时，捣鼓的小程序已经上线了一个 1.0 版)  
因为后端也没几个接口，所以也自己整了，用了业界比较靠谱的 NestJs,不得不说这种开箱即用的框架还是很爽的， Swagger,ORM 都是装插件就完事了，基于 DDD 的设计让控制器和业务逻辑代码分离写起来也很一目了然，基于装饰器模式的类型注解也提高了代码的解耦能力，吹也吹完了该说说这玩意哪里不好了

### 各框架的使用心得

Nestjs 文档虽然官网上有，但是是英文的，看起来稍微费点劲，中文的有很多大神在不同的站点做了翻译并分享，但是我看下来有不少都是翻译了部分或者没跟上版本，不过在初期还是有很大贡献的，赞美这些大佬，建议新手如果看中文文档时，可以去官网再瞅一眼。
**Nest 目前我遇到到最大的问题是在做 CI 时比较费劲，他默认打包策略是只输出应用程序相关编译结果到 dist 中却没带上编译时的依赖文件，只有给了依赖树的配置文件，emm，导致 docker 打包时就算我使用了最小的 alpine 镜像并且分镜像构建也做不到最小构建体积，因为必须要把 node_modules 模块一起放入镜像中，这又导致了在使用 github action 来做 CI 的时候 Push 镜像到国内的腾讯云会疯狂超时，太难受了**目前我就使用了腾讯云镜像仓的自动构建，但是没有后续的构建命令导致我还得上服务器手动部署，难受再加 1

在数据库调用上选择了 typeorm，刚开始的没有找到文档，不过后期发现了一个翻译的挺好的站点值得一看[typeorm](https://typeorm.biunav.com/zh/#%E5%AE%89%E8%A3%85),支持 code first,QueryBuild 写起来也挺好用，用上它感觉找到了以前写 c#时写 Linq 的爽快赶脚

### NodeJs 的 http 模块

整个 node 被设计成异步模块，数据通过监听异步事件的回调产生，多亏有 Promise，可以把整个请求包装起来通过 async/await 堵塞执行，不然回调写起来可真的费劲
